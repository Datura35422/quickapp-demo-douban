快应用优化技巧

#### 函数共享

使用框架API实现函数共享

#### 性能优化

- 通用的解决方案，这类具有普适性
- 与具体组件结合的解决方案，如：组件级别的懒加载，甚至利用组件本身特性完成优化

###### 简化ViewModel的数据

属性个数的定义越少越好，尤其是数组类型数据，建议过滤不需要用到的对象属性

###### 合理使用后代选择器

过多使用后代选择器会在节点匹配上带来性能损耗，尤其是当一个节点满足多个选择时。

优化建议：

- 避免使用组件名称（tag 标签名称）作为后代选择的最后一项匹配规则，如： `.doc-page #shop text { ... }`；否则每个 text 组件渲染时都会遍历匹配一次
- 减少后代选择的层级数量，层级越深，单次匹配耗时越长，如：`.class1 .class2 .class3 .class4 .class5 .class6 { ... }`
- 后代选择中最后一条匹配规则的定义名称尽量唯一，如：`.doc-page #shop .shop-item .shop-name-full { ... }`

#### 懒加载

主要有list组件和tabs组建中

#### 错误处理

###### 读取undefined上的属性

对一个值为 null 或 undefined 的变量取属性就会报错

**解决方案：**

1、&& 方法，通过逻辑运算的执行顺序来规避错误

2、 在 ViewModel 上增加函数方法

###### JSON.parse()解析出错

当服务器返回异常时，解析会出现错误。

**解决方案：**

1. 在每个 JSON.parse()的代码执行处进行 try-catch 包围，处理出错情况
2. 在 app.ux 中提前代理 JSON.parse()，使用 try-catch 包围，待异常出现时埋点数据，或者返回默认正常数据替代

###### 堆栈溢出问题

###### 结构优化

结构优化的目的是减小页面以及整体 rpk 包的体积，减少冗余代码

常用的手段有以下几项：

整合常用 JS 库到 app.ux 中

在`app.ux`中引入常用的 JS 库，并暴露给每个页面使用；可以避免每个页面在打包时对 JS 的重复定义

